<%- include('partials/header') %>

<div id="read-mode">
  <% if (book.coverUrl) { %>
    <img src="<%= book.coverUrl %>" alt="<%= book.name %> Cover" class="book-cover">
  <% } else { %>
    <p>No cover available</p>
  <% } %>

  <h1 class="bookname"><%= book.name %></h1>
  <span class="author">-by <%= book.author %></span>
  <span class="rating">
    Rating:
    <% for (let i = 1; i <= 5; i++) { %>
      <span style="color: <%= (i <= (book.rating && book.rating <= 5 ? book.rating : 1)) ? 'gold' : 'lightgray' %>;">
        <%= i <= (book.rating && book.rating <= 5 ? book.rating : 1) ? '★' : '☆' %>
      </span>      
    <% } %>
  </span>
  <p class="description"><%= book.description %></p>
  <hr>
  <h3>Notes:</h3>
  <p style="white-space: pre-wrap;"><%= book.notes %></p>
</div>

<!-- Editable form (initially hidden) -->
<form id="edit-mode" action="/update/<%= book.id %>" method="POST" style="display: none;">
  <label for="name">Title:</label>
  <input type="text" name="name" id="name" value="<%= book.name %>" required />

  <label for="author">Author:</label>
  <input type="text" name="author" id="author" value="<%= book.author %>" required />

  <label for="rating">Rating:</label>
  <input type="number" name="rating" id="rating" value="<%= book.rating %>" min="1" max="5" />

  <label for="description">Description:</label>
  <textarea name="description" id="description" rows="3"><%= book.description %></textarea>

  <label for="notes">Notes:</label>
  <textarea name="notes" id="notes" rows="5"><%= book.notes %></textarea>

  <button type="submit" class="btn btn-white btn-animated">Save Changes</button>
</form>

<!-- Toggle and delete buttons -->
<button id="toggle-edit" class="btn btn-white btn-animated">Edit</button>

<form action="/delete/<%= book.id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this book?');">
  <button type="submit" class="btn btn-delete btn-white btn-animated">Delete</button>
</form>

<script>
  const toggleBtn = document.getElementById("toggle-edit");
  const readMode = document.getElementById("read-mode");
  const editMode = document.getElementById("edit-mode");

  toggleBtn.addEventListener("click", () => {
    const editing = editMode.style.display === "block";
    if (editing) {
      editMode.style.display = "none";
      readMode.style.display = "block";
      toggleBtn.textContent = "Edit";
    } else {
      editMode.style.display = "block";
      readMode.style.display = "none";
      toggleBtn.textContent = "Cancel";
    }
  });
</script>

<%- include('partials/footer') %>
